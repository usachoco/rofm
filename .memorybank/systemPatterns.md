# システムアーキテクチャとデザインパターン

## 全体構成

- クライアントサイドのみで動作するシングルページアプリケーション（SPA）として構築する。
- HTML、CSS、JavaScriptを基盤とする。

## コンポーネントの概念（初期案）

- **グリッドコンポーネント**: メインのグリッド表示を担当。セルクリックイベントなどを管理。
- **エンティティコンポーネント**: 敵や味方のアイコン表示を担当。ドラッグ＆ドロップ機能などを検討。
- **UIコンポーネント**: コンテキストメニュー、保存/読み込みボタンなど、ユーザーインターフェース要素を担当。

## データ管理

- ローカルストレージを利用して、配置データをJSON形式で保存・読み込みを行う。

## 技術的決定（初期案）

- 特定のフレームワークは現時点では導入せず、プレーンなJavaScriptで開発を開始する。必要に応じて後から導入を検討する。

## 最新のシステムパターンと設計上の考慮事項

### 1. グリッドベースのUI設計と状態管理
- グリッドはHTMLの`div`要素で構成され、CSS GridまたはFlexboxでレイアウトされる。
- 各グリッドセルは、配置されたキャラクターのタイプ（味方/敵）とスキル影響範囲の状態を反映するために、動的にCSSクラスが適用される。
- `placedCharacters`オブジェクトは、グリッド上のキャラクターの位置、名前、タイプを管理する主要なデータ構造として機能する。

### 2. スキル影響範囲の可視化
- マウスオーバー時のスキル範囲ハイライトには、キャラクターの視認性を損なわないよう`box-shadow`プロパティを使用する。
- スキル発動時には、ターゲットセルと影響範囲内のすべてのセルに専用のCSSクラスを適用し、永続的な視覚フィードバックを提供する。
- スキル範囲の計算は、中心座標とスキルサイズ（例: 3x3, 5x5）に基づいて行われるヘルパー関数によって抽象化される。

### 3. データ共有機能
- 配置データはJSON形式でシリアライズされ、Base64エンコードによってURLセーフな文字列に変換される。
- URLクエリパラメータを介してデータを共有することで、サーバーサイドの永続化なしにフォーメーションの共有を可能にする。
- ページロード時にURLから自動的にデータをデコードし、グリッドに適用するロジックを実装する。

### 4. イベントハンドリングと排他制御
- キャラクター選択、スキル選択、グリッドセルクリックなどのUIインタラクションは、JavaScriptのイベントリスナーによって処理される。
- キャラクター配置モードとスキル選択モードは排他的に制御され、ユーザーが意図しない操作を行わないようにする。
- リセットボタンは、グリッドの状態と選択されたモードを初期状態に戻す役割を果たす。
